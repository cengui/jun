<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<meta name="robots" content="none,noindex,nofollow" />
<title>魔线网 - 眼疾手快</title>
<link rel="stylesheet" href="css/reset.css" />
<link  rel="stylesheet" href="css/admin.css"/>
<script type="text/javascript" src="js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="js/jquery.md5.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/api_user.js"></script>
<link rel="stylesheet" href="css/all.css" />
</head>

<body>
<div id="doc" class="y-t1">
	<div id="hd">
		<div class="top-user">
			当前登陆账户：<strong id="curuser" class="em">--</strong>, 
			魔币数量：<strong id="curmobi" class="em">--</strong> <input type="button" id="updateCurUser"  value="更新" />
			
		</div>
	</div>
    <div class="bd">
    	<div class="bd-in clear">
        	<div class="main">
            	<div class="main-in" style="min-height:700px;">
					
					<div class="content">
						<div style="position:relative;padding-top:380px" id="yjsk">
							
							<div id="gidbox" style="position:absolute;width:710px;height:366px;top:0;left:0;border:1px solid #000;background:#fff;">
								<img src="http://rs.moxian.com/resource//common_info/images/header.png" alt="" id="gidimage" style="position:absolute;top:0;left:0;" />
								<ul style="position:absolute;left:0;top:0;width:710px;height:305px;" id="ulbox"></ul>
							</div>
							
							<div>
								间隔时间：<input type="text" id="timeout" value="10000" /> 
								总分：<input type="text" id="totnum" value="10000" /> 
								<input type="button" value="自动刷魔币" onclick="autoStart()" />
							</div>
							
							<div>
								<img src="http://rs.moxian.com/resource//common_info/images/header.png" alt="" id="rulet" style="position:absolute;margin-left:500px;"/>
								<input type="button" style="padding:.3em;" value="初始化" id="creategid" /> 
								<input type="button" style="padding:.3em;" value="开局" id="okcreate" />
								<a href="http://app.moxian.com/apps/quickhand/web/fasthand_large.html" target="_blank">游戏链接</a>		
							</div>
							<br/>
							<div><input type="text" style="padding:0.3em; width:300px;" class="input" />  <input type="button" value=" 提交 " style="padding:.3em;" class="submitinput" data-index="0"  /></div>
							<br/>
							<div><input type="text" style="padding:0.3em; width:300px;" class="input" />  <input type="button" value=" 提交 " style="padding:.3em;" class="submitinput" data-index="1" /></div>
							<br/>
							<div><input type="text" style="padding:0.3em; width:300px;" class="input" />  <input type="button" value=" 提交 " style="padding:.3em;" class="submitinput" data-index="2" /></div>
							<div id="canvasbox" class="hide"></div>
						</div>	
					</div>
					
					<div class="user-list">
						<div><input type="button" value="查看账户列表" id="viewUserList" /></div>
						
						<ul id="userlist" class="hide">
							<li>
								<input type="text" value="jelle.lu@gmail.com" id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, jun_0ooo, 13682637304, 鲁军
								</div>
								<input type="button" class="login" value="登陆" data-id="4899" />  <input type="button" class="update" value="更新" data-id="4899" />
							</li>
							<li>
								<input type="text" value="317591243@qq.com" id="" />
								<input type="text" value="l123456789" id="" />
								<div class="info">
									<span class="em mobi">--</span>, 室长, 18665300176, 谭思毅
									
								</div>
								<input type="button" class="login" value="登陆" data-id="5200" />  <input type="button" class="update" value="更新" data-id="5200" />
							</li>
							<li>
								<input type="text" value="ludaiqian@126.com" id="" />
								<input type="text" value="12345678" id="" />
								<div class="info">
									<span class="em mobi">--</span>, 张小程, 13104851022, 鲁谦
									
								</div>
								<input type="button" class="login" value="登陆" data-id="5195" />  <input type="button" class="update" data-id="5195" value="更新" />
							</li>
							<li>
								<input type="text" value="909696966@qq.com" id="" />
								<input type="text"  value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, 雅思, 18682132445, 鲁代乾
									
								</div>
								<input type="button" class="login" value="登陆" data-id="5192" />  <input type="button" class="update" data-id="5192" value="更新" />
							</li>
							<li>
								<input type="text" value="806361192@qq.com" id="" />
								<input type="text" value="l123456789" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, tom_li1, 13424376580, 老虎
								</div>
								<input type="button" class="login" value="登陆" data-id="5202" />  <input type="button" class="update" data-id="5202" value="更新" />
							</li>
							<li>
								<input type="text" value="308938872@qq.com" id="" />
								<input type="text" value="l123456789" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, 守喉幸福, 13510368960, 谭雅丽
								</div>
								<input type="button" class="login" value="登陆" data-id="5249" />  <input type="button" class="update" data-id="5249" value="更新" />
							</li>
							
							<li>
								<input type="text" value="164370785@qq.com" id="" />
								<input type="text" value="l123456789" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, 小晴晴, 18781718898, 敬小晴
								</div>
								<input type="button" class="login" value="登陆" data-id="5250" />  <input type="button" class="update" data-id="5250" value="更新" />
							</li>
							
							<li>
								<input type="text" value="393659258@qq.com" id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, tellli, 15919483914, 李宁
								</div>
								<input type="button" class="login" value="登陆" data-id="5286" />  <input type="button" class="update" data-id="5286" value="更新" />
							</li>
							
							<li>
								<input type="text" value="729605042@qq.com" id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, tellme, 18282251987, 董江伟
								</div>
								<input type="button" class="login" value="登陆" data-id="5301" />  <input type="button" class="update" data-id="5301" value="更新" />
							</li>
							
							<li>
								<input type="text" value="erjiefuge@163.com" id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 13508276933, 姐夫
								</div>
								<input type="button" class="login" value="登陆" data-id="5302" />  <input type="button" class="update" data-id="5302" value="更新" />
							</li>
							
							<li>
								<input type="text" value="chaogege11111@163.com " id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 18628149674, 超哥
								</div>
								<input type="button" class="login" value="登陆" data-id="5303" />  <input type="button" class="update" data-id="5303" value="更新" />
							</li>
							

							<li>
								<input type="text" value="erjiejie1203456@163.com " id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 13550582826, 3姐
								</div>
								<input type="button" class="login" value="登陆" data-id="5304" />  <input type="button" class="update" data-id="5304" value="更新" />
							</li>
							
							
							<li>
								<input type="text" value="luxiaobo0213@163.com " id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 18038048660, 小波
								</div>
								<input type="button" class="login" value="登陆" data-id="5305" />  <input type="button" class="update" data-id="5305" value="更新" />
							</li>
							
							
							<li>
								<input type="text" value="jiaejie12034460@163.com " id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 18092581930, 老姐
								</div>
								<input type="button" class="login" value="登陆" data-id="5307" />  <input type="button" class="update" data-id="5307" value="更新" />
							</li>


							<li>
								<input type="text" value="zhangwenfang6745@163.com " id="" />
								<input type="text" value="l123456" id="" />
								
								<div class="info">
									<span class="em mobi">--</span>, ---, 18856591813, 张文芳
								</div>
								<input type="button" class="login" value="登陆" data-id="5308" />  <input type="button" class="update" data-id="5308" value="更新" />
							</li>
						</ul>
						
					</div>
               </div>
            </div>
        	<div class="side">
				<dl class="nav">
					<dt>功能选择</dt>
					<dd class="on"><a href="index.html">眼疾手快刷分</a></dd>
					<dd><a href="paimai.html">拍卖</a></dd>
				</dl>
				
				<div class="log" >
					<div class="log-title">Log</div>
					<div class="log-context" id="log">
					</div>
					<div class="log-op"><input type="button" value=" Clear Log " onclick="page.clearLog()" /></div>
				</div>
			</div>
        </div>
    </div>
   <!-- <div class="fd">fd</div>-->
</div>
<script type="text/javascript" src="js/page_main.js"></script>
<script type="text/javascript">
		$('#canvasbox').append('<canvas width="704" height="365" id="test1"></canvas><canvas width="704" height="365" id="test2"></canvas>');
		
		function imgbijiao( src, callback ){
			
			var array = [];
			var canvas = document.getElementById("test1");
			var ctx = canvas.getContext("2d");
			
			var canvas2 = document.getElementById("test2");
			var ctx2 = canvas2.getContext("2d");
				
				
			var image = new Image();
			image.onload =imageLoaded;
			//顶部背景图片
			image.src = src || "http://app.moxian.com/apps/quickhand/system/getimage.php?gid=25638";

			//用来保存像素数组的变量
			var imageData=null;
			function imageLoaded() {
				// 将图片画到画布上
				ctx.drawImage(image, 0, 0);
				
				var imgData = [];
				for(var i=0; i<40; i++){
					var x = i % 8;
					var y = parseInt(i/8);
					imgData.push(ctx.getImageData(x*88, y*73, 88, 73));
					//ctx2.putImageData(imgData[imgData.length-1], x*88, y*73);
				}
				
				duibi(imgData);
				callback( array );
			}
			
			
			function duibi(imgData){

				for(var j=0; j<imgData.length; j++){
					array[j] = [];
					if(imgData[j]){
						array[j].push(j);
						for(var i=0; i<imgData.length; i++){
							if(imgData[i] && j != i){
								var rgbs = duibiDB(imgData[j], imgData[i]);
								//console.log(j, rgbs)
								if(rgbs < 5000){
									array[j].push(i);
									imgData[i] = false;
								}
							}
						}
					}
				}
				
			};
			
			
			function duibiDB(imgData1, imgData2){
				//var s = 0;
				var img1 = {
					r:0,g:0,b:0
				};
				var img2 = {
					r:0,g:0,b:0
				};
				var im1;
				var im2;
				for(var i=0; i<88; i++){
					for(var j=0; j<73; j++){
						var im1 = getxyRGB(imgData1, imgData1.width, j, i);
						var im2 = getxyRGB(imgData2, imgData2.width, j, i);
						img1.r += im1.r;
						img1.g += im1.g;
						img1.b += im1.b;
						
						img2.r += im2.r;
						img2.g += im2.g;
						img2.b += im2.b;
		
					}
				}
				
				//console.log(img1, img2);
				
		
				//return {rs:Math.abs(img1.r-img2.r), gs:Math.abs(img1.g-img2.g),bs:(img1.b-img2.b)};
				return Math.abs(img1.r-img2.r) + Math.abs(img1.g-img2.g) + Math.abs(img1.b-img2.b);
			}
			
			function getxyRGB(img, width, y, x){
				var p = (y * width + x) * 4;
				//return colorHex("RGB("+img.data[p+0]+","+img.data[p+0]+","+img.data[p+0]+")");
				return {r:img.data[p+0],g:img.data[p+1],b:img.data[p+2]};
			}
		}
</script>
<script type="text/javascript">
	//imgbijiao
	
	
	
	Common.page = {
		url:"http://app.moxian.com/apps/quickhand/system/getimage.php?gid=",
		rank:1,
		width:70,
		height:60,
		input:null,
		time:1,
		sum:0
	};
	
	if(Common.page.rank == 1){
		Common.page.width = 87;
		Common.page.height = 72;
	}
		
	function createLi(){
			var html = '';
			var len = Common.page.rank == 1 ? 40 : 60;
			for(var i=0; i<len; i++){
				html += '<li data-index="'+i+'" style="width:'+Common.page.width+'px;height:'+Common.page.height+'px;float:left;border-top:1px solid #000;border-left:1px solid #000;"></li>';
			}
			$('#ulbox').html( html );
	};
	createLi();
	
	$('#gidbox').find('li').click(function(){
			
		//$(this).attr('checked', '1');
		if( $(this).attr('checked') == "1" ){//清除
			$(this).attr('checked', '0');
			$(this).css({background:"rgba(155,155,155,0)"});
			Common.page.input.val( Common.page.input.val().replace(','+$(this).attr("data-index")), '');
		}else{
			$(this).attr('checked', '1');
			$(this).css({background:"rgba(155,155,155,.5)"});
			Common.page.input.val( Common.page.input.val()+','+$(this).attr("data-index") );
		}
	});	
	
	Common.page.input = $('.input').eq(0);
	
	$('#yjsk .input').click(function(){
		Common.page.input = $(this);
	});
		
	Common.api = {
		create:function(autostart){
			var rank = 1;
			var model = new GameYJSKModel();
			var ctrl = new BaseController();
			ctrl.update = function(data ,action ){
				Common.page.gid = data.gid;
				if(autostart){
					Common.api.start();
				}
				$('#gidimage').attr('src', Common.page.url+data.gid);
				imgbijiao(Common.page.url+data.gid, function(array){

					array.sort(function(a, b){
						return b.length - a.length;
					});
					
					$('.input').eq(0).val(','+array[0]);
					$('.input').eq(1).val(','+array[1]);
					/**
					Common.page.time = setTimeout(function(){
						submit(0);
					}, Common.random(6,4));
					*/
				});
				$('#gidbox').find('li').each(function(){
					$(this).attr('checked', '0');
					$(this).css({background:"rgba(155,155,155,0)"});
				});
				$('#yjsk .input').each(function(){
					$(this).val('');
				});
			};
			model.addObserver( ctrl );
			model.creategame( rank );
		},
		start:function(){
			var model = new GameYJSKModel();
			var ctrl = new BaseController();
			ctrl.update = function(data){
				$('#rulet').attr('src', data.card);
			};
			model.addObserver(ctrl);
			model.start( Common.page.gid );
		},
		submit:function(index){
			clearTimeout(Common.page.time);
			var val = $('#yjsk .input').eq(index).val();
			val = val.slice(1);
			var model = new GameYJSKModel();
			var ctrl = new BaseController();
			ctrl.update = function(data){
				if(data.status == 0){
					Common.page.sum += data.obtain;
					if(Common.page.sum > Common.page.tot){
						clearInterval(Common.page.timeout);
					};
					User.changeMobi(data.mobi);
					console.log("当前魔币："+data.mobi, "本次获得:"+data.obtain);
					
				}else if(data.status == 5){
					console.log("错误:速度太慢"+ 5);
				}else if(data.status == 4){
					console.log("错误:4");
				}else{
					console.log("错误:"+data.status);
				}
			};
			model.addObserver(ctrl);
			model.checkchoose( Common.page.gid , val);
		}
	};
	
	$('#creategid').click(Common.api.create);
	$('#okcreate').click(Common.api.start);
	$('.submitinput').click(function(){
		var index = parseInt($(this).attr("data-index"));
		Common.api.submit( index );
	});
	
	function autoStart(){
		console.log("执行程序开始");
		Common.page.sum = 0;
		Common.page.tot = parseInt($('#totnum').val());
		clearInterval(Common.page.timeout);
		Common.page.timeout = setInterval(function(){
		
			Common.api.create(true);

			setTimeout(function(){
				Common.api.submit(0);
			}, Common.random(2000, 3000))

			
		}, parseInt($('#timeout').val()));
	}
	//page.login("idche@qq.com", "l123456");
	
	//可以动态更新魔币
	page.updateUserInfoRegEvent();
	
	
</script>
</body>
</html>