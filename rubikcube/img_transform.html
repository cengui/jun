<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>Hello</title>
	<style type="text/css">
		body {position: absolute; margin:0; padding:0;width:100%; height:100%}
		canvas {display:block;border:2px solid #ccc; margin:10px auto;}
		p {text-align: center; font-size:12px;color:#454545;}
	</style>
</head>
<body>
	<canvas id="canvas" width="600" height="200">浏览器不支持</canvas>
	<canvas id="canvas2" width="600" height="200"></canvas>
	<script type="text/javascript">
		
		var canvas = document.getElementById("canvas");
		var canvas2 = document.getElementById("canvas2"); 
			
			ctx = canvas.getContext("2d");
			ctx2 = canvas2.getContext("2d");
		
		
		var img = new Image();
			img.onload = function(){
				//console.log(this);
				ctx2.drawImage(this, 50, 50, this.width, this.height);
				
				var imageData = ctx2.getImageData(50,50, img.width, img.height);
					//imageData.width = img.width;
					//imageData.height = img.height;
				
				var t = Date.now();
				var imgdata = translate(imageData, 10, 10);
				ctx.putImageData(imgdata, 50, 50);
				console.log(Date.now() - t);
			};
			img.src = "images/app3_hover.png";
			
		
		function translate(imageData, x, y){ //平行移动 生成新图像
			
			var width = imageData.width;
			var height = imageData.height;
			
			var newImageData = ctx.createImageData(width+ Math.abs(x), height+Math.abs(y));
			
			var wl = width + Math.abs(x);
			var hl = height + Math.abs(y);
			
			x = x < 0 ? 0 : x;
			y = y < 0 ? 0 : y;
			
			
			var len = width*height*4;
			
			

			for(var i=0; i<len; i+=4){
				var sx = parseInt(i/4)%width;
				var sy = parseInt(parseInt(i/4)/width);

				newImageData.data[(wl * (y+sy))*4 + (x+sx)*4] = imageData.data[i];
				newImageData.data[(wl * (y+sy))*4 + (x+sx)*4+1] = imageData.data[i+1];
				newImageData.data[(wl * (y+sy))*4 + (x+sx)*4+2] = imageData.data[i+2];
				newImageData.data[(wl * (y+sy))*4 + (x+sx)*4+3] = imageData.data[i+3];
			}
			
			for(var i=0; i<newImageData.data.length; i+=4){
				
				if(newImageData.data[i+3] == 0){
					newImageData.data[i+3] = 255;
				}
			}
			//console.log(newImageData);
			return newImageData;
		}
		
		
	</script>
</body>
</html>