<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>Test 5</title>
	<style type="text/css">
		html {overflow:hidden}
		body {position: absolute; margin:0; padding:0;width:100%; height:100%}
		canvas {display:block;border:2px solid #ccc; margin:10px auto;}
		p {text-align: center; font-size:12px;color:#454545;}
	</style>
	<script type="text/javascript" src="js/june.js"></script>
	<script type="text/javascript" src="js/plugin.js"></script>
</head>
<body>
	<canvas id="canvas" width="600" height="400"></canvas>
	<div style="text-align:center;">
		<input type="button" value="上" onclick="stage.up()" />
		<input type="button" value="下" onclick="stage.down()"/>
		<input type="button" value="左" onclick="stage.left()"/>
		<input type="button" value="右" onclick="stage.right()"/>
	</div>
	<img src="images/applogo.png" id="applogo" alt="" />
	<script type="text/javascript">
	
		var apps = [
			{
			app_height: "0",
			app_id: "27",
			app_name: "心情日志",
			app_picture: "images/applogo.png",
			app_url: "http://app.hk.moxian.com:8000/mxpost/web/blog_large.html",
			app_url_show: "http://app.hk.moxian.com:8000/mxpost/web/blog_large.html"
			}
		];
	
		
		var img = null;
		
		for(var i=0; i < apps.length; i++){
			img = new Image();
			img.src = "images/applogo.png";
			apps[i].app_img = img;
		}
		
		var canvas = document.getElementById('canvas');
		var stage = new June.stage(canvas, 600, 400);
		
		//stage.ctx;
		function Rects(stage, rect){
			//前后
			this.stage = stage;
			this.data = null;
			this.after = [];
			//this.rects = [];
			this.rect = rect;
			//this.init();
		}

		Rects.prototype = {
			init:function(){},
			setRectData:function(data){
				this.data = data;
			},
			frontBackInit:function(){
				var after = this.after;
				var data = this.data;
				//var rects = this.rects;
				var frontRects = this.frontRects = [];
				var backRects = this.backRects = [];
				for(var i=0; i<data.length; i++){
					after.push([data[i][0], data[i][1], -data[i][2]]);
					frontRects.push(new this.rect(this.stage, data[i][0], data[i][1], data[i][2], "#f30f30", 0));
					backRects.push(new this.rect(this.stage, data[i][0], data[i][1], -data[i][2], "#cccccc", 2));
				}
				
			},
			upDownInit:function(){
				var after = this.after;
				var data = this.data;
				var upRects = this.upRects = [];
				var downRects = this.downRects = [];
				
				for(var i=0; i<data.length; i++){
					after.push([data[i][0], data[i][1], -data[i][2]]);
					upRects.push(new this.rect(this.stage, data[i][0], data[i][1], data[i][2], "#ff9900", 4));
					downRects.push(new this.rect(this.stage, data[i][0], -data[i][1], data[i][2], "#3c00ff", 5));
				}
			},
			leftRightInit:function(){
				var after = this.after;
				var data = this.data;
				var leftRects = this.leftRects = [];
				var rightRects = this.rightRects = [];
				for(var i=0; i<data.length; i++){
					after.push([data[i][0], data[i][1], -data[i][2]]);
					rightRects.push(new this.rect(this.stage, data[i][0], data[i][1], data[i][2], "#3ab504", 3));
					leftRects.push(new this.rect(this.stage, -data[i][0], data[i][1], data[i][2], "#fff60e", 1));
				}
			},
			setDepth:function(depth, rects){
				for(var i=0; i<rects.length; i++){
					rects[i].setDepth(depth);
				}
			}
		};
		
		//*
		//上下
		var updown = new Rects(stage, UpDownRect);
		updown.data = [
			[-155, -155, 155],
			[-50, -155, 155],
			[55, -155, 155],
			
			[-155, -155, 50],
			[-50, -155, 50],
			[55, -155, 50],
			
			[-155, -155, -55],
			[-50, -155, -55],
			[55, -155, -55]
			
		];
		updown.upDownInit();
		
		
		// 前后
		var frontBack = new Rects(stage, FrontBackRect);
		frontBack.data = [
			[-155, -155, -155],
			[-155, -50, -155],
			[-155, 55, -155],
			
			[-50, -155, -155],
			[-50, -50, -155],
			[-50, 55, -155],
			
			[55, -155, -155],
			[55, -50, -155],
			[55, 55, -155]
		];
		frontBack.frontBackInit();
		
		//*
		//左右
		var leftRight = new Rects(stage, LeftRightRect);
		leftRight.data = [
			[155, -155, -155],
			[155, -155, -50],
			[155, -155, 55],
			
			[155, -50, -155],
			[155, -50, -50],
			[155, -50, 55],
			
			[155, 55, -155],
			[155, 55, -50],
			[155, 55, 55]
			
		];
		leftRight.leftRightInit();
		// */
		
		
		var angleY = 0;//Math.PI/4;//Math.PI/4;//Math.PI/4;
		var angleX = 0;//Math.PI/4;
		
		var countangleY = 0;
		var countangleX = 0;
		// */
		stage.addEvent('mousemove', function (x, y) {
			angleY = (x - 300) * .0005;
            angleX = (y - 200) * .0005;
		});
		
		stage.ondraw = function(){};
		
		stage.draw = function(){
			//var t = new Date().getTime();
			this.clear();
			
			this.childList.sort(function (a, b) {//排序
				return b.depth - a.depth
			});
			
			var ctx = this.ctx;//重画
			for(var i=0; i<this.childList.length; i++){
				this.childList[i].draw(ctx);
			}
			//console.log(new Date().getTime() -t );
		};
		
		stage.rotation = function(angleX, angleY){
			//var angleX = 0.10;
			//var angleY = 0.10;
			var countangleX = 0;
			var countangleY = 0;
			var _this = this;
			var id = setInterval(function(){
				countangleX += angleX;
				countangleY += angleY;

				countangleX = Math.abs(countangleX) > Math.PI/2 ? Math.PI/2 * (countangleX > 0 ? 1 : -1) : countangleX;
				countangleY = Math.abs(countangleY) > Math.PI/2 ? Math.PI/2 * (countangleY > 0 ? 1 : -1) : countangleY;

				for(var i=0; i<_this.childList.length; i++){ //旋转
					if(countangleY != 0){
					_this.childList[i].rotateY(countangleY);
					}else{
					_this.childList[i].rotateX(countangleX);
					}
				}
				_this.draw();
				
				if(Math.abs(countangleX) == Math.PI/2 || Math.abs(countangleY) == Math.PI/2){
					for(var i=0; i<_this.childList.length; i++){ //旋转
						_this.childList[i].update();
					}
					clearInterval(id);
				}
				
			}, 30)
		};
		
		stage.up = function(){
			
			stage.rotation(-0.10, 0);
		};
		
		stage.down = function(){
			
			stage.rotation(0.10, 0);
		};
		
		stage.left = function(){
			
			stage.rotation(0, -0.10);
		};
		
		stage.right = function(){
			
			stage.rotation(0, 0.10);
		};
		
		stage.start();
		setTimeout(function(){
			//stage.stop();
		}, 0)
       // g.stroke();  
	</script>
</body>
</html>