
<!DOCTYPE html>
<html>
<style>
html {overflow:hidden}
body {position: absolute; margin:0; padding:0;width:100%; height:100%}
canvas {display:block;border:2px solid #ccc; margin:10px auto;}
p {text-align: center; font-size:12px;color:#454545;}
</style>
<script src="js/JCanvas.0.1.js"></script>
<canvas id="canvas" width="600" height="400"></canvas>

<script>
	
	

	

	var canvas = document.getElementById('canvas');
	var stage = new CVS.$stage(canvas);

	var initialize = function () {
		var focalLength = 250,
			ballN = 20,
			balls = [],
			areas = [],
			vpx = 0,
			vpy = 0,
			angleY = 0,
			angleX = 0,
			createRect = CVS.createRect;
			
		var cube = [
			//前
			[-155, 155, 155],
			[155, 155, 155],
			[155, -155, 155],
			[-155, -155, 155],
			//后
			
			[-155, 155, -155],
			[155, 155, -155],
			[155, -155, -155],
			[-155, -155, -155],
			//下
			[-155, 155, 155],
			[155, 155, 155],
			[155, 155, -155],
			[-155, 155, -155]/****/,
			
			//上
			[155, -155, 155],
			[-155, -155, 155],
			[-155, -155, -155],
			[155, -155, -155],
			
			//左
			[155, -155, 155],
			[155, -155, -155],
			
			[155, 155, -155],
			[155, 155, 155],
			
			
			//右
			[-155, -155, 155],
			[-155, -155, -155],
			
			[-155, 155, -155],
			[-155, 155, 155]
			/**/
			
			
		],
		triangles = [];

			vpx = canvas.width / 2;
			vpy = canvas.height / 2;
			
			
		for (var i=0; i<cube.length; i++) {

			var ball = CVS.createPoint3D(stage.ctx, function () {
				this.xpos = cube[i][0];
				this.ypos = cube[i][1];
				this.zpos = cube[i][2];
				this.width = 0;
				this.draw = function () {
					//console.log(this.width);
					//this.ctx.beginPath();
					//this.ctx.arc(0, 0, this.width/2, 0, Math.PI*2, true);
					//this.ctx.closePath();
					//this.ctx.fill();
				};
			});
			ball.setVanishPoint(vpx, vpy);
			ball.setCenterPoint(0, 0, 600);
			stage.addChild(ball);
			balls.push(ball);
		}

		//前
		var triangle = createRect(stage.ctx, balls[0], balls[1], balls[2], balls[3], 0x66cc66);
		//triangle.draw();
		triangles.push(triangle);
		
		//后
		var triangle = createRect(stage.ctx, balls[4], balls[5], balls[6], balls[7], 0xcc6666);
		//triangle.draw();
		triangles.push(triangle);
		
		//下
		var triangle = createRect(stage.ctx, balls[8], balls[9], balls[10], balls[11], 0xcc66cc);
		//triangle.draw();
		triangles.push(triangle);
		/***/
		//上
		var triangle = createRect(stage.ctx, balls[12], balls[13], balls[14], balls[15], 0xcc66cc);
		//triangle.draw();
		triangles.push(triangle);
		
		//左
		var triangle = createRect(stage.ctx, balls[16], balls[17], balls[18], balls[19], 0xcccc66);
		//triangle.draw();
		triangles.push(triangle);
		
		//右
		var triangle = createRect(stage.ctx, balls[20], balls[21], balls[22], balls[23], 0xcccc66);
		//triangle.draw();
		triangles.push(triangle);
		/**/
		//stage.addEventListener('mousemove', function (x, y) {
		//	angleY = (x - vpx) * .0005;
        //    angleX = (y - vpy) * .0005;
		//});
	
		function randomColor () {
			return 'rgba('+Math.floor(Math.random()*256)+', '+Math.floor(Math.random()*256)+', '+Math.floor(Math.random()*256)+', 0.5)';
		}
		

		stage.onRefresh = function () { 
			for (var i=0,ball; ball=balls[i]; i++) { 
			   ball.rotateX(angleX);
			   ball.rotateY(angleY);

			   ball.x = ball.screenX;
			   ball.y = ball.screenY;
            }

            triangles.sort(function (a, b) { return b.depth - a.depth });
			for (var j = 0; j < triangles.length; j ++) {
				triangles[j].draw();
			}
		};
		/**
		stage.start = function(){
			this.isStart = true;
			this.render();
			this.onRefresh();
		};
		*/
		stage.moveLeft = function(){
			var _this = this;
			var i = 0;
			angleX = 0.1;
			angleY = 0;
			var c = setInterval(function(){
				console.log(i++);
				if(i >= 15){
					clearInterval( c );
				}
				_this.render();
				_this.onRefresh();
			}, 30);
		};
		
		stage.start();
		window.triangles = triangles;
	};

	onload = initialize;

	//stage.

</script>
</html>

