<!DOCTYPE HTML>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Hello Jun</title>
    <script src="src/FlatSystem.js"></script>
    
</head>
<body>
    <div>
        <canvas width="1000" height="300" id="helloworld"></canvas>
    </div>
    <script>
        function $(id){
            return document.getElementById(id);
        }
        var ctx = new FlatSystem($('helloworld').getContext("2d"), 1000, 300);
        ctx.setCalibration(40);
        ctx.onlyQuadrant(1);
        ctx.init();
        
        function Line(x1,y1, x2,y2){
            this.x1 = x1;
            this.y1 = y1;
            
            this.x2 = x2;
            this.y2 = y2;
            this.init();
        }
        Line.prototype = {
            constructor:Line,
            init:function(){
                
                this.a = (this.y1-this.y2)/ (this.x1-this.x2);
                this.b = this.y1 - this.a;
                this.getY = function(x){
                    return a*x + b;
                };
            },
            draw:function(ctx){
                //console.log(this.x1, this.y1, this.x2, this.y2);
                ctx.printLine(this.x1, this.y1, this.x2, this.y2);
            }
        };
    </script>
	<script>
        /**
            line = {
                x1:,y1:,x2:,y2:
            }
            point = {
                x1:, y1:
            }
        */
        function isOnLine(line, point){
        
            /**
                y = ax+b;
                首先根据line的起点和终点 计算出a 和 b的值。(线段所在直线的标准公式)
                然后吧point 带入 y = ax + b; 等式成立point在直线 y = ax + b 上。
                然后判断 点x的取值范围如果在线段line的起点x 和重点x之间即point在线段line上,否则不在线段line上。

            */
            var x1 = line.x1;
            var y1 = line.y1;
            var x2 = line.x2;
            var y2 = line.y2;
                    //y = ax+b;
            return  Math.min(x1, x2) <= point.x1 && Math.max(x1, x2) >= point.x1 && (point.y1 == (y1-y2)/ (x1-x2)  * point.x1 + (y1 - (y1-y2) / (x1-x2)*x1) );
        };
        
        function isLineIntersect(line1, line2){
            var x1 = line1.x1;
            var x2 = line1.x2;
            
            var y1 = line1.y1;
            var y2 = line1.y2;
            
            var a1 = (y1-y2)/ (x1-x2);
            var b1 = y1 - a1*x1;
            
            
            //-----------------
            var x3 = line2.x1;
            var x4 = line2.x2;
            
            var y3 = line2.y1;
            var y4 = line2.y2;
            
            var a2 = (y3-y4)/ (x3-x4);
            var b2 = y3 - a2*x3;
            
            console.log(a1,b1);
            console.log(a2,b2);
             
            if( a1/a2 != b1 / b2 ){//直线有交点
                console.log("直线有焦点");
                /**
                    y1 = a1*x1 + b1; 
                    y2 = a2*x1 + b2;
                    以上两条直线有焦点，那么焦点坐标p(x,y) 如下表示
                */
                var x = - (b2-b1) / (a2-a1);
                //console.log(a1,x1, b1);
                var y = a1 * x + b1;
                //console.log(x, y);
                return isOnLine(line1, {x1:x, y1:y}) && isOnLine(line2, {x1:x, y1:y});//判断焦点坐标在当前第一条线段上说明 两条线段有焦点，否则无焦点
                
            }
            
            return false;
        }
        
        
        
        function test(){
            var line = {
                x1:3,y1:100, x2:3,y2:100
            };
            
            var point = {
                x1:2,
                y1:51
            };
            
            return isOnLine(line, point);
        };
        
        function test2(){
            
            // y = 3x + 5;
            var line = {
                x1:-20,y1:-55, x2:100, y2:305
            };
            
            // y = 0.5x + 10;
            //var line2 = {
           //     x1:-80,y1:-30, x2:1000, y2:510
           // };
            
            var line2 = {
                x1:20,y1:20, x2:1000, y2:510
            };
            
            new Line(line.x1,line.y1, line.x2, line.y2).draw(ctx);
            new Line(line2.x1,line2.y1, line2.x2, line2.y2).draw(ctx);
            
            return isLineIntersect(line, line2);
        };
        
        
        
        
    </script>
</body>
</html>