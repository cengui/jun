MX.extend(MX.kit,function(){function c(a){this.option=a;this.minWidth=200;this.minHeight=100;this.dir=this.oldy=this.oldx=this.top=this.left=this.height=this.width=0}c.prototype={init:function(){var a=this;this.events={r:function(b){a.option.sizeElement.width(this.checkMinWidth(a.width+(b.x-a.oldx)))},b:function(b){a.option.sizeElement.height(this.checkMinHeight(a.height+(b.y-a.oldy)))},br:function(b){a.events.r(b);a.events.b(b)},t:function(b){var d=this.checkMinHeight(a.height+(a.oldy-b.y));a.option.sizeElement.height(d);
d!=a.minHeight&&a.option.sizeElement.css("top",a.top-(a.oldy-b.y))},l:function(b){var d=this.checkMinWidth(a.width+(a.oldx-b.x));a.option.sizeElement.width(d);d!=a.minWidth&&a.option.sizeElement.css("left",a.left-(a.oldx-b.x))},bl:function(b){a.events.l(b);a.events.b(b)},tr:function(b){a.events.t(b);a.events.r(b)},tl:function(b){a.events.t(b);a.events.l(b)},checkMinWidth:function(b){return b<a.minWidth?a.minWidth:b},checkMinHeight:function(b){return b<a.minHeight?a.minHeight:b},move:function(b){a.move(b);
return!1},up:function(b){a.up(b);return!1}};this.setRangeWindow();this.option.dragElements.show().bind("mousedown",function(b){var d=$(this).attr("data-dir");a.replaceProperty(b.screenX,b.screenY,d);a.down();return!1})},replaceProperty:function(a,b,d){var e=this.option.sizeElement,c=e.offset();this.width=e.width();this.height=e.height();this.left=c.left;this.top=c.top;this.oldx=a;this.oldy=b;this.dir=d},down:function(){var a=$(document);this.setRangeWindow();a.bind("mousemove",this.events.move);a.bind("mouseup",
this.events.up);this.onfocus()},move:function(a){if(this.checkBoundary(a.pageX,a.pageY))this.events[this.dir]({x:a.screenX,y:a.screenY})},checkBoundary:function(a,b){var d=this.option.range;return a<d[0]||b<d[1]||a>d[2]||b>d[3]?!1:!0},up:function(){var a=$(document);a.unbind("mousemove",this.events.move);a.unbind("mouseup",this.events.up);var a=this.option.sizeElement,b=a.offset();this.width=a.width();this.height=a.height();this.left=b.left;this.top=b.top;this.onblur(this.width,this.height,this.left,
this.top)},setRangeWindow:function(){var a=$(window).scrollTop(),b=$(window).scrollLeft(),d=$(window).width()+b-5,e=$(window).height()+a-5;this.option.range=[b+5,a+5,d,e]},onfocus:function(){},onblur:function(){}};return{Resize:c}}());
MX.extend(MX.kit,function(){function c(a){var b={dragElement:null,moveElement:null,isRange:!0,isResize:!0,offsetTop:35};this.left=this.top=this.height=this.width=0;$.extend(b,a);this.option=b;this.events={}}c.prototype={init:function(){var a=this;this.option.iscap=this.option.dragElement[0].setCapture?!0:!1;$.extend(this.events,{down:function(b){a.down(b);return!1},up:function(b){a.up(b);return!1},move:function(b){a.move(b);return!1}});this.zIndex();this.createMask();this.option.isRange&&!this.option.range&&
this.setRangeWindow();this.start();this.setResize();this.onready()},zIndex:function(){this.minzIndex=this.option.dragElement.css("z-index")||10},createMask:function(){this.mask=$('<div style="position:fixed;display:none;top:0;left:0;opacity:0;background:#000;filter:alpha(opacity=0)"></div>');this.setMask(0,0,$(window).width(),$(window).height(),this.minzIndex+1);$("#mxDialogWarp").append(this.mask)},showMask:function(){this.mask.show()},hideMask:function(){this.mask.hide()},removeMask:function(){this.mask.remove()},
setMask:function(a,b,d,e,c){this.mask.css({top:a,left:b,width:d,height:e,"z-index":c})},setMaskIndex:function(a){this.mask.css("z-index",a||MX.ui.mxDialog.index)},start:function(){this.option.dragElement.bind("mousedown",this.events.down)},down:function(a){var b=this.option.dragElement,d=this.option.moveElement,e=$(document),c=d.offset();this.width=d.width()+7;this.height=d.height()+7+this.option.offsetTop;this.setRangeWindow();this.option.iscap&&b[0].setCapture();this.offset={x:a.screenX-c.left,
y:a.screenY-c.top};this.showMask();e.bind("mousemove",this.events.move);e.bind("mouseup",this.events.up);this.onfocus(a.screenX,a.screenY)},move:function(a){var b=this.option.moveElement,c=this.offset,e=a.screenX-c.x-$(window).scrollLeft(),a=a.screenY-c.y-$(window).scrollTop();if(this.option.isRange)a=this.checkBoundary(e,a),e=a.x,a=a.y;this.left=e;this.top=a;b[0].style.left=e+"px";b[0].style.top=a+"px";this.onmove(e,a)},up:function(){var a=$(document),b=this.option.dragElement;this.option.iscap&&
b[0].releaseCapture();this.hideMask();a.unbind("mousemove",this.events.move);a.unbind("mouseup",this.events.up);this.onblur()},stop:function(){this.removeMask()},checkBoundary:function(a,b){var c=this.option.range,a=a>c[2]-this.width?c[2]-this.width:a,b=b>c[3]-this.height?c[3]-this.height:b,a=a<c[0]?c[0]:a,b=b<c[1]?c[1]:b;return{x:a,y:b}},setResize:function(){var a=this;if(!this.option.isResize)return this.option.moveElement.find(".mx-dialog-change").hide(),!1;this.resize=new MX.kit.Resize({dragElements:this.option.moveElement.find(".mx-dialog-change"),
sizeElement:this.option.moveElement});this.resize.onfocus=function(){a.showMask();a.setMaskIndex()};this.resize.onblur=function(b,c,e,f){a.width=b;a.height=c;a.top=f;a.left=e;a.onResize();a.hideMask()};this.resize.init()},setRange:function(a,b,c,e){this.option.isRange=!0;this.option.range=[a,b,c,e]},setRangeWindow:function(){var a=$(window).width()+0,b=$(window).height()+0;this.option.isRange=!0;this.option.range=[0,0,a,b];this.setMask(0,0,a,b,this.minzIndex)},onfocus:function(){},onblur:function(){},
onmove:function(){},onexit:function(){},onready:function(){},onResize:function(){}};return{DragElement:c}}());
MX.extend(MX.ui,function(){function c(a){this.id=c.count++;this.isMax=!1;this.isClose=!0;this.isResize=this.isMaximize=!1;this.isMove=!0;this.title="MoXian.com";this.minHeight=this.minWidth=100;this.width=400;this.height=300;this.left=this.top=0;this.overflow=!0;this.index=c.index++;this.ui={};$.extend(this,a)}c.dialogList=[];c.count=1;c.index=100;c.close=function(a){for(var b=0;b<this.dialogList.length;b++)if(this.dialogList[b].id==a)return this.dialogList[b].setClose(),!0;return!1};c.lang={cn:{home:"\u4e3b\u9875",
maximize:"\u6700\u5927\u5316",restore:"\u8fd8\u539f",close:"\u5173\u95ed"},en:{home:"Home",maximize:"Maximize",restore:"Restore",close:"Close"}};c.lang.currentLang=c.lang.cn;c.prototype={getTpl:function(){var a=c.lang.currentLang;return'<div class="mx-dialog" id="mxDialog_<%=id%>" style="width:<%=width%>px;height:<%=height%>px;left:<%=left%>px;top:<%=top%>px;z-index:<%=index%>">\t\t\t\t<div class="mx-dialog-t mx-dialog-change" style="display:none;" data-dir="t"></div>\t\t\t\t<div class="mx-dialog-b mx-dialog-change" style="display:none;" data-dir="b"></div>\t\t\t\t<div class="mx-dialog-r mx-dialog-change" style="display:none;" data-dir="r"></div>\t\t\t\t<div class="mx-dialog-l mx-dialog-change"  style="display:none;" data-dir="l"></div>\t\t\t\t<div class="mx-dialog-tr mx-dialog-change"  style="display:none;" data-dir="tr"></div>\t\t\t\t<div class="mx-dialog-tl mx-dialog-change" style="display:none;" data-dir="tl"></div>\t\t\t\t<div class="mx-dialog-br mx-dialog-change" style="display:none;" data-dir="br"></div>\t\t\t\t<div class="mx-dialog-bl mx-dialog-change" style="display:none;" data-dir="bl"></div>\t\t\t\t<div class="mx-dialog-title"><div class="mx-dialog-title-in">\t\t\t\t\t<div class="mx-dialog-tool"><a href="###" class="mx-dialog-home" title="'+
a.home+'"></a></div>\t\t\t\t\t<h1 class="mx-dialog-h1"><%=title%></h1>\t\t\t\t\t<div class="mx-dialog-buttons">\t\t\t\t\t\t<%if(isMaximize){%>\t\t\t\t\t\t\t<a href="###" class="mx-dialog-maximize" title="'+a.maximize+'"></a>\t\t\t\t\t\t\t<a href="###" class="mx-dialog-restore" style="display:none;" title="'+a.restore+'"></a>\t\t\t\t\t\t<%}%>\t\t\t\t\t\t<%if(isClose){%>\t\t\t\t\t\t\t<a href="###" class="mx-dialog-close" title="'+a.close+'"></a>\t\t\t\t\t\t<%}%>\t\t\t\t\t</div>\t\t\t\t</div></div>\t\t\t\t<div class="mx-dialog-content" style="width:100%;height:100%;left:0;top:0;">\t\t\t\t\t<iframe class="mx-dialog-iframe" src="<%=url%>" hidefocus frameborder="no" allowtransparency="true" height="100%" width="100%"></iframe>\t\t\t\t</div>\t\t\t</div>'},
init:function(){this.updatePos();var a=Common.tmpl(this.getTpl(),this);this.ui.dialogWarp=this.createDialogWarp();this.ui.dialogWarp.append(a);this.ui.mxDialog=$("#mxDialog_"+this.id);$.extend(this.ui,{maximize:this.ui.mxDialog.find(".mx-dialog-maximize"),restore:this.ui.mxDialog.find(".mx-dialog-restore"),close:this.ui.mxDialog.find(".mx-dialog-close"),iframe:this.ui.mxDialog.find(".mx-dialog-iframe"),title:this.ui.mxDialog.find(".mx-dialog-title"),h1:this.ui.mxDialog.find(".mx-dialog-h1"),home:this.ui.mxDialog.find(".mx-dialog-home")});
this.overflow==!1&&this.ui.iframe.attr("scrolling","no");this.isMove&&this.drag();this.regEvents();this.mask();c.dialogList.push(this);this.onready()},regEvents:function(){var a=this;this.ui.maximize.click(function(){a.setMaximize();return!1});this.ui.restore.click(function(){a.setRestore();return!1});this.ui.close.click(function(){a.setClose();return!1});this.ui.home.click(function(){a.setGohome();return!1});this.ui.h1.mousedown(function(){a.setFocus();return!1});$(window).resize(function(){a.isMax&&
a.setMaximize()})},updatePos:function(){this.top=($(window).height()-this.height)/2;this.left=($(window).width()-this.width)/2;this.top=this.top<0?0:this.top;this.left=this.left<0?0:this.left},drag:function(){var a=this;this.drag=new MX.kit.DragElement({dragElement:this.ui.h1,moveElement:this.ui.mxDialog,isResize:this.isResize});this.drag.onready=function(){var a=this;$(window).resize(function(){a.setRangeWindow()})};this.drag.onblur=function(){a.top=this.top;a.left=this.left};this.drag.onResize=
function(){a.width=this.width;a.height=this.height;a.top=this.top;a.left=this.left};this.drag.init()},createDialogWarp:function(){var a=$("#mxDialogWarp");if($("#mxDialogWarp").size())return a;a=$('<div class="mx-dialog-warp" id="mxDialogWarp"></div>');$(document.body).append(a);return a},mask:function(){if($("#mxDialogMask").size())this.ui.maskElement=$("#mxDialogMask");else{$(document.body).height();var a=$('<div style="background:black;width:100%;height:100%;position:fixed;z-index:99;opacity:.5;top:0;left:0;filter:alpha(opacity=50);-moz-opacity:.5;" id="mxDialogMask"></div>');
this.ui.dialogWarp.append(a);this.ui.maskElement=a}},removeMask:function(){this.ui.maskElement.remove()},setPos:function(a,b,c,e){this.ui.mxDialog.css({width:c+"px",height:e+"px",top:a+"px",left:b+"px"});this.onresize()},setRemove:function(){this.ui.mxDialog.remove()},setClose:function(){this.ui.mxDialog.hide();this.setRemove();this.drag&&this.drag.stop();for(var a=0;a<c.dialogList.length;a++)if(c.dialogList[a]==this){c.dialogList.splice(a,1);break}c.dialogList.length==0&&this.removeMask();this.onclose()},
setOpen:function(){this.ui.mxDialog.show()},setRefresh:function(){},setGohome:function(){this.ui.iframe[0].src=this.url+"?"+(new Date).getTime()},setRestore:function(){this.isMax=!1;this.setPos(this.top,this.left,this.width-1,this.height-1);this.ui.restore.hide();this.ui.maximize.show();var a=this;setTimeout(function(){a.setPos(a.top,a.left,a.width,a.height)},20)},setMaximize:function(){var a=$(window).width()-5,b=$(window).height()-40;this.isMax=!0;this.setPos(0,0,a,b);this.ui.maximize.hide();this.ui.restore.show()},
setFocus:function(){this.ui.mxDialog.css("z-index",c.index++);this.drag&&this.drag.setMaskIndex(c.index)},onclose:function(){},onready:function(){},onresize:function(){}};return{Dialog:c}}());try{if(user_info.mx_lang=="en")MX.mxDialog.lang.currentLang=mxDialog.lang.en;if(user_info.mx_lang=="zh")MX.mxDialog.lang.currentLang=mxDialog.lang.cn}catch(e$$22){};MX.extend(MX.ui,{ok:function(c,a){this.tip({context:c,okbtn:!1,cancelbtn:!1,type:"success",timeout:a||3E3,title:base_lang.tip}).ui.close.focus()},alert:function(c,a){this.tip({context:c,cancelbtn:!1,type:"notice",callback:a,title:base_lang.tip}).ui.ok.focus()},confirm:function(c,a){this.tip({context:c,closebtn:!1,type:"notice",callback:function(b){a&&a(b=="ok"?!0:!1)},title:base_lang.tip}).ui.ok.focus()},tip:function(){function c(a){this.option={title:base_lang.tip,context:"hello world",callback:function(){},
timeout:0,okbtn:!0,cancelbtn:!0,closebtn:!0,type:"notice"};$.extend(this.option,a);this.init()}var a=base_lang.ok,b=base_lang.cancel,d='<div class="moxian-ui-tip">\t\t\t\t<div class="ui-tip-wrapper">\t\t\t\t\t<div class="ui-tip-main">\t\t\t\t\t\t<div class="ui-tip-title">\t\t\t\t\t\t\t<h1><%=title%></h1>\t\t\t\t\t\t\t<%if(closebtn){%>\t\t\t\t\t\t\t<input type="button" class="ui-btn-close" title="'+base_lang.close+'" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="ui-tip-context">\t\t\t\t\t\t\t<p class="p">\t\t\t\t\t\t\t\t<span class="ui-tip-icon ui-tip-<%=type%>"></span><span><%=context%></span>\t\t\t\t\t\t\t</p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="ui-tip-btn">\t\t\t\t\t\t\t<%if(okbtn){%>\t\t\t\t\t\t\t\t<input type="button" title="'+
a+'" class="ui-btn-ok" value="'+a+'" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t<%if(cancelbtn){%>\t\t\t\t\t\t\t\t<input type="button" title="'+b+'" class="ui-btn-cancel" value="'+b+'" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="ui-tip-bg"></div>\t\t\t</div>';c.prototype={init:function(){var a=Common.tmpl(d,this.option),a=$("<div></div>").append(a);this.ui={wrapper:a.find(".moxian-ui-tip"),title:a.find(".ui-tip-title"),close:a.find(".ui-btn-close"),ok:a.find(".ui-btn-ok"),
cancel:a.find(".ui-btn-cancel")};$(document.body).append(a.find(".moxian-ui-tip"));this.regEvent();this.option.timeout&&this.setTimeout(this.option.timeout);(new MX.kit.DragElement({dragElement:this.ui.title,moveElement:this.ui.wrapper,isRange:!1,isResize:!1,offsetTop:0})).init();this.updatePos()},regEvent:function(){function a(c){c.keyCode==27&&(b.close("close"),$(window).unbind("keyup",a))}var b=this;this.ui.close.click(function(){b.close("close")});this.ui.ok.click(function(){b.close("ok")});this.ui.cancel.click(function(){b.close("cancel")});
$(document).keyup(a)},close:function(a){this.ui.wrapper.remove();this.option.callback(a)},updatePos:function(){var a=$(window).height(),b=$(window).width();this.setPos((a-this.ui.wrapper.height())/2,(b-this.ui.wrapper.width())/2)},setTimeout:function(a){var b=this;setTimeout(function(){b.close("auto")},a)},setPos:function(a,b){this.ui.wrapper.css({top:a+"px",left:b+"px"})}};return function(a){return new c(a)}}()});
